% x_trim is the trimmed state,
% u_trim is the trimmed input
  
  
[A,B,C,D]=linmod('mavsim_trim',x_trim,u_trim);

%Sifting matrices:
E1 = [...
0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0;...
0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0;...
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1;...
0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0;...
0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0;...
];

E2 = [...
0, 1, 0, 0;...
0, 0, 1, 0;...
];

E3 = [...
0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0;...
0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0;...
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0;...
0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0;...
0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0;...
];

E4 = [...
1, 0, 0, 0;...
0, 0, 0, 1;...
];

%Assuming Linear Model:
A_lat = E1 * A * transpose(E1) ;
B_lat = E1 * B * transpose(E2);

A_lon = E3 * A * transpose(E3);
B_lon = E3 * B * transpose(E4);